<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <meta name="format-detection" content="telephone=no, email=no, date=no, address=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta http-equiv="Pragma" content="no-cache">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="format-detection" content="telephone=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <link type="text/css" rel="stylesheet" href="../systable/css/table.css" />
<!--    <script type="text/javascript" src="../systable/js/SYSTABLE.min.js"></script>-->
    <script type="text/javascript" src="../systable/js/systable.js"></script>
    <script type="text/javascript" src="../systable/js/template.js"></script>
    <title>密码管理平台</title>
</head>
<body>
    <div class="mtb10 clearfix" id="btn-operation">
        <a href="javascript:;" class="btn btn-green btnEvent" name="DeleteCheckbox">删除选中</a>
        <span class="r-f search-style">
            <input type="text" placeholder="输入关键字查询" value="" name="searchText"  class="input-text" /><a href="javascript:;" class="btn btn-blue btnEvent" name="searchEvent">搜索</a>
        </span>
    </div>
    <table class="gallery table table_list table_striped table-bordered border " id="tableList" style="width: 100%;" cellpadding="0">
        <thead>
        <tr>
            <th width="50px">
                <label class="checkbox relative"><input type="checkbox" class="ace" name="checkbox"><span class="lbl"></span></label>
            </th>
            <th>平台名称</th>
            <th>状态</th>
            <th>用户名</th>
            <th>备注</th>
            <th>手机号</th>
            <th>邮箱</th>
            <th>创建时间</th>
            <th>最后修改</th>
            <th>操作</th>
        </tr>
        </thead>
        <tbody id="UserList">
        </tbody>
    </table>
    <!--分页-->
    <div class="Paging" id="pagination">

    </div>
    <div class="margi20 color3 clearfix">该测试结合template插件进行操作</div>
    <div class="color4 mtb10">new SYSTableSorter({ 编辑方法 })</div>
    <table class="table tab-content table-bordered table_striped border table-hover table-responsive ">
        <thead>
        <tr>
            <th class="text-center" width="12%">参数</th>
            <th class="text-center" width="12%">参数名</th>
            <th class="text-center" width="15%">值</th>
            <th class="text-center">说明</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>TableName</td>
            <td>表格名称</td>
            <td class="color3">null</td>
            <td>添加需要操作的表格名称</td>
        </tr>
        <tr>
            <td>btnArea</td>
            <td>按钮操作</td>
            <td class="color3">null</td>
            <td>设置需要对表格进行操作的区域，默认为DeleteCheckbox删除选中,searchEvent搜索 操作</td>
        </tr>
        <tr>
            <td>paginName</td>
            <td>分页</td>
            <td class="color3">null</td>
            <td>对表格进行分页操作的区域</td>
        </tr>
        <tr>
            <td>curPage</td>
            <td>当前显示页</td>
            <td class="color3">1</td>
            <td>
                对表格进行分页操作默认显示当前第几页的参数，为整数

            </td>
        </tr>
        <tr>
            <td>Sequence</td>
            <td>排序</td>
            <td class="color3">[整数]</td>
            <td>数组模式，根据table表格有几列，自定义数量集</td>
        </tr>
        <tr>
            <td ><span class="color4">Callback</span></td>
            <td>数据</td>
            <td>回调</td>
            <td>回调数据在这里写，获取table表格的数据 使用index.ajaxGet(API,callback); //回调方法get</td>
        </tr>
        </tbody>
    </table>
    <div class="mtb10">
        <table class="table tab-content table-bordered table_striped border table-hover table-responsive ">
            <thead>
            <tr>
                <th class="text-center" width="12%">方法</th>
                <th class="text-center">名称</th>
                <th class="text-center">说明</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>DeleteEvent</td>
                <td>删除事件</td>
                <td>删除当前数据，根据表格中的tr<span class="color3">data-id</span>值进行操作，使用index.ajaxPost()方法进行API交互</td>
            </tr>
            <tr>
                <td>SaveEvent</td>
                <td>保存提交修改</td>
                <td>保存提交修改当前数据，根据表格中的tr<span class="color3">data-id</span>值进行操作，使用index.ajaxPost()方法进行API交互</td>
            </tr>
            <tr>
                <td>DetailedEvent</td>
                <td>详细</td>
                <td>自行编辑</td>
            </tr>
            <tr>
                <td>CheckboxDeleteEvent</td>
                <td>Checkbox删除事件</td>
                <td>根据选Checkbox选中状态进行操作，根据表格中的tr<span class="color3">data-id</span>值进行操作，使用index.ajaxPost()方法进行API交互</td>
            </tr>
            <tr>
                <td>SearchEvent</td>
                <td>查询</td>
                <td>自行编辑</td>
            </tr>
            </tbody>

        </table>
    </div>
    <div class="mtb10">
        <table class="table tab-content table-bordered table_striped border table-hover table-responsive ">
            <thead>
            <tr>
                <th class="text-center" width="12%">事件</th>
                <th class="text-center">名称</th>
                <th class="text-center">说明</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>index.BtnoperationMethod(Table, index) </td>
                <td>按钮操作事件方法 </td>
                <td>Table表格名称，index事件集合</td>
            </tr>
            <tr>
                <td>index.pageTableMethod(html,curPage,pageTotal,pageSize,total) </td>
                <td>分页功能设置</td>
                <td>html内容，curPage当前页数，pageTotal总页数，pageSize显示条数，total总数</td>
            </tr>
            <tr>
                <td>index.ajaxGet(API,callback)</td>
                <td>get获取数据</td>
                <td>API接口地址，callback方法回调 </td>
            </tr>
            <tr>
                <td> index.ajaxPost(API)</td>
                <td>post提交方法</td>
                <td>API接口地址</td>
            </tr>
            </tbody>

        </table>
    </div>
</body>
</html>

<script type="text/html" id="tablehtml">
    <%if(list!=""){ %>
    <% for(var i = 0; i < pageym; i++) { %>
    <% var num = (page-1) * pagenum + i; %>
    <tr class="relative" data-id="<%=list[num].id%>">
        <td><label class="checkbox relative"><input type="checkbox" class="ace" name="checkbox"><span class="lbl"></span></label></td>
        <td class="table-edit" data-value="platformId"><%=list[num].platformId%></td>
        <td>
            <% if(list[num].status==0) {%>
            <span class="name_status  plf10 btn btn-gray" data-id="0">关闭</span>
            <%} if(list[num].status==1) {%>
            <span class="name_status  plf10 btn btn-green" data-id="1">启用</span>
            <%}%>
        </td>
        <td class="table-edit" data-value="username">
            <a href="javascript:void(0)" class="colorred" onclick="memberinfo(this,<%=list[num].id%>)"><%=list[num].username%></a></td>
        <td class="table-edit" data-value="remark"><%=list[num].remark%></td>
        <td class="table-edit" data-value="phone"><%=list[num].phone %></td>
        <td class="table-edit" data-value="email"><%=list[num].email %> </td>
        <td><%=list[num].createTime.substring(0,19).replace('T',' ') %></td>
        <td><%=(list[num].lastModifyTime).substring(0,19).replace('T',' ') %></td>
        <td>
            <button class="btn btn-danger padding5" name="deleteEvent">删除</button>
            <button class="btn btn-blue padding5" name="modifyEvent">修改</button>
            <!--<button class="btn btn-blue padding5" name="detailedEvent">详细</button>-->
            <button class="btn btn-blue padding5" name="detailedEvent">复制密码</button>
        </td>
    </tr>
    <% } %>

    <% } else{%>
    <tr><td colspan="9">暂时还没有该等级的会员</td></tr>
    <% } %>
</script>
<script>
    new SYSTableSorter({
        TableName:'tableList',
        btnArea:'btn-operation',
        paginName:'pagination',
        curPage:1,//声明默认显示页数为0
        Sequence:[3,5,7,8], //排序
        Callback:function(obj,index,curPage){//index 方法集合
            var sysindex = function(callback) {
                index.ajaxGet("getpswlist?userId=2",callback); //回调方法get
            };
            sysindex(function(listArr){
                //使用json获取数据
                var pageSize = 10;//设置每页显示数量
                var total=listArr.data.length//获取数据总数
                var pageTotal= Math.ceil(total / pageSize);//获取页码数
                var contentname = TAB$('UserList');
                var Table = TAB$(index.par.TableName);
                var currentPages = curPage * pageSize < total ? pageSize : total - (curPage - 1) * pageSize;//判断页码
                var html = template('tablehtml', {
                    page: curPage, //当前页数
                    pagenum: pageSize, //每页显示数量
                    pageym: currentPages, //当前页码
                    list: listArr.data,
                    grade: listArr.grade
                });
                contentname.innerHTML=html;
                index.BtnoperationMethod(Table, index); //按钮操作事件方法
                index.currentcheckbox(Table,index);//单选样式操作方法调用
                index.pageTableMethod(html,curPage,pageTotal,pageSize,total);//分页功能设置

            });
            //上面主要通过javascript json模式进行数据操作,同时也可以使用API接口形式进行数据操作

        },//主要指的回调table数据
        DeleteEvent: function(layer,index,id) { //layer当前层,index table方法集合,id根据数据id进行数据删除修改
            index.ajaxPost('removepsw?id='+id,null,null,layer);//post提交方法
            // setTimeout(function(){alert('删除成功')},4000);
            layer.parentNode.remove();//删除当前显示数据
        }, //删除
        SaveEvent: function(layer,index,id,data,evnet) {  //layer当前层,index table集合,id根据数据id进行数据删除修改,evnet当前事件对象
            alert(data + "passwordId="+id);
            var obj = this.URLDateToJsonStr(data + "passwordId="+id+"&");
            console.log(obj);
            data = "data=" + obj;
            index.ajaxPost('modifypsw',obj,evnet,layer, "application/json"); // 分别为url地址,data数据,evnet,事件对象,layer当前层
        } ,//保存提交修改方法
        DetailedEvent:function(layer,index,id){
            //,可设置链接地址跳转,或是弹框显示内容(弹框可使用SYSbox弹框插件)也可以使用第三方

        },//详细(自己写)
        CheckboxDeleteEvent:function(index,layer,id){//  remove删除当前显示数据
            index.ajaxPost('application/json/directory.json&id='+id);
            layer.remove();
        },//Checkbox删除事件
        SearchEvent:function(index,value){//value查询条件内容关键字
            //根据查询条件筛选内容方法
            //通过get方法获取查询内容
        },
        URLDateToObject:function(data) {
            var obj = new Object();
            var paramArr = data.split("&");
            for(var i = 0; i < paramArr.length - 1; i++){
                var pos = paramArr[i].indexOf("=");
                obj[paramArr[i].substring(0, pos)] = paramArr[i].substring(pos + 1);
            }
            if(obj == "undefined") return null;
            else return obj;
        },
        URLDateToJsonStr:function(data) {
            var obj = this.URLDateToObject(data);
            var str = JSON.stringify(obj);
            return str;
        }
    });

    //时间转换,template插件扩展功能
    template.defaults.imports.timestamp = function(date, format) {
        if(typeof date === "string") {
            var mts = date.match(/(\/Date(\d+)\/)/);
            if(mts && mts.length >= 3) {
                date = parseInt(mts[2]);
            }
        }
        date = new Date(parseInt(date * 1000));
        if(!date || date.toUTCString() == "Invalid Date") {
            return "";
        }
        var map = {
            "M": date.getMonth() + 1, //月份
            "d": date.getDate(), //日
            "h": date.getHours(), //小时
            "m": date.getMinutes(), //分
            "s": date.getSeconds(), //秒
            "q": Math.floor((date.getMonth() + 3) / 3), //季度
            "S": date.getMilliseconds() //毫秒
        };
        format = format.replace(/([yMdhmsqS])+/g, function(all, t) {
            var v = map[t];
            if(v !== undefined) {
                if(all.length > 1) {
                    v = '0' + v;
                    v = v.substr(v.length - 2);
                }
                return v;
            } else if(t === 'y') {
                return(date.getFullYear() + '').substr(4 - all.length);
            }
            return all;
        });
        return format;
    };
</script>